#!/bin/bash

BRANCH="${1}"
SIGNATURE="${2}"

generate_post_data()
{
cat <<EOF
{
    "body": "{\"ref\":\"refs/heads/master\",\"before\":\"6c61e633aed661a686706c606ee574c9ecb2dfb4\",\"after\":\"34449752e44b1df6fb8a56b01413297ccc3df6b9\",\"created\":false,\"deleted\":false,\"forced\":false,\"base_ref\":null,\"compare\":\"https://github.com/garethgreenaway/saltconf17/compare/6c61e633aed6...34449752e44b\",\"commits\":[{\"id\":\"34449752e44b1df6fb8a56b01413297ccc3df6b9\",\"tree_id\":\"bfe043dc2fd31dabb191c78570166143eaa2b39d\",\"distinct\":true,\"message\":\"Removing foo\",\"timestamp\":\"2017-10-26T17:05:15-07:00\",\"url\":\"https://github.com/garethgreenaway/saltconf17/commit/34449752e44b1df6fb8a56b01413297ccc3df6b9\",\"author\":{\"name\":\"Gareth J. Greenaway\",\"email\":\"gareth@wiked.org\",\"username\":\"garethgreenaway\"},\"committer\":{\"name\":\"Gareth J. Greenaway\",\"email\":\"gareth@wiked.org\",\"username\":\"garethgreenaway\"},\"added\":[],\"removed\":[\"foo\"],\"modified\":[]}],\"head_commit\":{\"id\":\"34449752e44b1df6fb8a56b01413297ccc3df6b9\",\"tree_id\":\"bfe043dc2fd31dabb191c78570166143eaa2b39d\",\"distinct\":true,\"message\":\"Removing foo\",\"timestamp\":\"2017-10-26T17:05:15-07:00\",\"url\":\"https://github.com/garethgreenaway/saltconf17/commit/34449752e44b1df6fb8a56b01413297ccc3df6b9\",\"author\":{\"name\":\"Gareth J. Greenaway\",\"email\":\"gareth@wiked.org\",\"username\":\"garethgreenaway\"},\"committer\":{\"name\":\"Gareth J. Greenaway\",\"email\":\"gareth@wiked.org\",\"username\":\"garethgreenaway\"},\"added\":[],\"removed\":[\"foo\"],\"modified\":[]},\"repository\":{\"id\":108453567,\"name\":\"saltconf17\",\"full_name\":\"garethgreenaway/saltconf17\",\"owner\":{\"name\":\"garethgreenaway\",\"email\":\"gareth@wiked.org\",\"login\":\"garethgreenaway\",\"id\":718525,\"avatar_url\":\"https://avatars0.githubusercontent.com/u/718525?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/garethgreenaway\",\"html_url\":\"https://github.com/garethgreenaway\",\"followers_url\":\"https://api.github.com/users/garethgreenaway/followers\",\"following_url\":\"https://api.github.com/users/garethgreenaway/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/garethgreenaway/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/garethgreenaway/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/garethgreenaway/subscriptions\",\"organizations_url\":\"https://api.github.com/users/garethgreenaway/orgs\",\"repos_url\":\"https://api.github.com/users/garethgreenaway/repos\",\"events_url\":\"https://api.github.com/users/garethgreenaway/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/garethgreenaway/received_events\",\"type\":\"User\",\"site_admin\":false},\"private\":false,\"html_url\":\"https://github.com/garethgreenaway/saltconf17\",\"description\":\"SaltConf 17\",\"fork\":false,\"url\":\"https://github.com/garethgreenaway/saltconf17\",\"forks_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/forks\",\"keys_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/keys{/key_id}\",\"collaborators_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/collaborators{/collaborator}\",\"teams_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/teams\",\"hooks_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/hooks\",\"issue_events_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/issues/events{/number}\",\"events_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/events\",\"assignees_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/assignees{/user}\",\"branches_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/branches{/branch}\",\"tags_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/tags\",\"blobs_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/git/blobs{/sha}\",\"git_tags_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/git/tags{/sha}\",\"git_refs_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/git/refs{/sha}\",\"trees_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/git/trees{/sha}\",\"statuses_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/statuses/{sha}\",\"languages_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/languages\",\"stargazers_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/stargazers\",\"contributors_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/contributors\",\"subscribers_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/subscribers\",\"subscription_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/subscription\",\"commits_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/commits{/sha}\",\"git_commits_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/git/commits{/sha}\",\"comments_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/comments{/number}\",\"issue_comment_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/issues/comments{/number}\",\"contents_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/contents/{+path}\",\"compare_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/compare/{base}...{head}\",\"merges_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/merges\",\"archive_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/{archive_format}{/ref}\",\"downloads_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/downloads\",\"issues_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/issues{/number}\",\"pulls_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/pulls{/number}\",\"milestones_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/milestones{/number}\",\"notifications_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/notifications{?since,all,participating}\",\"labels_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/labels{/name}\",\"releases_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/releases{/id}\",\"deployments_url\":\"https://api.github.com/repos/garethgreenaway/saltconf17/deployments\",\"created_at\":1509044415,\"updated_at\":\"2017-10-26T22:59:39Z\",\"pushed_at\":1509062723,\"git_url\":\"git://github.com/garethgreenaway/saltconf17.git\",\"ssh_url\":\"git@github.com:garethgreenaway/saltconf17.git\",\"clone_url\":\"https://github.com/garethgreenaway/saltconf17.git\",\"svn_url\":\"https://github.com/garethgreenaway/saltconf17\",\"homepage\":null,\"size\":3,\"stargazers_count\":0,\"watchers_count\":0,\"language\":\"Python\",\"has_issues\":true,\"has_projects\":true,\"has_downloads\":true,\"has_wiki\":true,\"has_pages\":false,\"forks_count\":0,\"mirror_url\":null,\"archived\":false,\"open_issues_count\":0,\"forks\":0,\"open_issues\":0,\"watchers\":0,\"default_branch\":\"master\",\"stargazers\":0,\"master_branch\":\"master\"},\"pusher\":{\"name\":\"garethgreenaway\",\"email\":\"gareth@wiked.org\"},\"sender\":{\"login\":\"garethgreenaway\",\"id\":718525,\"avatar_url\":\"https://avatars0.githubusercontent.com/u/718525?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/garethgreenaway\",\"html_url\":\"https://github.com/garethgreenaway\",\"followers_url\":\"https://api.github.com/users/garethgreenaway/followers\",\"following_url\":\"https://api.github.com/users/garethgreenaway/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/garethgreenaway/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/garethgreenaway/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/garethgreenaway/subscriptions\",\"organizations_url\":\"https://api.github.com/users/garethgreenaway/orgs\",\"repos_url\":\"https://api.github.com/users/garethgreenaway/repos\",\"events_url\":\"https://api.github.com/users/garethgreenaway/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/garethgreenaway/received_events\",\"type\":\"User\",\"site_admin\":false}}",
    "repository": { "name": "saltconf17"},
    "ref": "refs/heads/${BRANCH}"
}
EOF
}

curl -k -H "Content-Type: application/json" -H "X-Hub-Signature: sha1=${SIGNATURE}" -X POST -d "$(generate_post_data)" https://localhost:8080/hook/github/push


